<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="https://api.mapbox.com/mapbox-gl-js/v2.3.1/mapbox-gl.js"></script>
    <link
      href="https://api.mapbox.com/mapbox-gl-js/v2.3.1/mapbox-gl.css"
      rel="stylesheet"
    />

    <title>Document</title>
  </head>

  <body>
    <style>
      .marker {
        display: block;
        border: none;
        border-radius: 50%;
        cursor: pointer;
        padding: 0;
      }
    </style>
    <h2>
      <label for="">Show me all of the upcoming WAR Zones between: </label>
    </h2>
    <input id="dateInput1" type="date" />
    <label> and </label>
    <input id="dateInput2" type="date" />
    <button id="theButton" onclick="getEvents()">Ok... show them to me!</button>
    <div id="map" style="width: 100%; height: 400px"></div>
    <script>
      let eventList = [
        {
          name: "the battle",
          date: "2021-01-01",
          location: [-81, 28],
          url: "https://google.com",
        },
        {
          name: "the other battle",
          date: "2021-01-08",
          location: [-80, 27],
          url: "https://yahoo.com",
        },
        {
          name: "my house",
          date: "2021-07-18",
          location: [-73.49907, 40.72002],
          url: "https://jasonlaytonsawesomelife.com",
        },
        {
          name: "my house",
          date: "2021-07-18",
          location: [-73.59907, 40.72002],
          url: "https://jasonlaytonsawesomelife.com",
        },
      ];

      mapboxgl.accessToken =
        "pk.eyJ1IjoiY29hY2h3YXluZSIsImEiOiJja3I1OXQxNGkzM29yMm9vOGo4MXlkaWt5In0.hr4oQDHbSpnOwwYOVLPvug";
      let map = new mapboxgl.Map({
        container: "map",
        style: "mapbox://styles/mapbox/streets-v11",
        center: [-80, 36.722335],
        zoom: 4,
      });
      /* this portion uses geolocation to track the user and zoom in on them, but they need to click a small button first, and it doesn't seem to work well for the purposes I had in mind. It would be nice if the map loaded showing a 100 mile radius of where the user was located.

      // Initialize the geolocate control.
      var geolocate = new mapboxgl.GeolocateControl({
        positionOptions: {
          enableHighAccuracy: true,
        },
        trackUserLocation: true,
      });
      // Add the control to the map.
      map.addControl(geolocate);
      // Set an event listener that fires
      // when a geolocate event occurs.
      geolocate.on("geolocate", function () {
        console.log("A geolocate event has occurred.");
      });
*/
      let today = new Date().toISOString().split("T")[0];

      //we start by listing all of the upcoming events on the map
      for (let x = 0; x < eventList.length; x++) {
        if (eventList[x].date >= today) {
          let el = document.createElement("div");
          el.className = "marker";
          el.style.backgroundImage =
            "url(https://i.ibb.co/VtYM6tV/Screen-Shot-2021-07-16-at-10-16-46-PM.png)";
          el.style.width = "25px";
          el.style.height = "25px";
          el.style.backgroundSize = "100%";

          new mapboxgl.Marker(el)
            .setLngLat(eventList[x].location)
            .setPopup(
              new mapboxgl.Popup({ offset: 25 }) // add popups
                .setHTML(
                  `<h3>${eventList[x].name}</h3><h4>${eventList[x].date}</h4><a href=${eventList[x].url}>click for event details</a>`
                )
            )
            .addTo(map);
        }
      }

      // the customer can press the button to only show events between specified dates
      let getEvents = () => {
        let date1 = document.getElementById("dateInput1").value;
        let date2 = document.getElementById("dateInput2").value;
        map.remove();
        map = new mapboxgl.Map({
          container: "map",
          style: "mapbox://styles/mapbox/streets-v11",
          center: [-97, 40.722335],
          zoom: 3,
        });
        for (let x = 0; x < eventList.length; x++) {
          if (eventList[x].date >= date1 && eventList[x].date <= date2) {
            let el = document.createElement("div");
            el.className = "marker";
            el.style.backgroundImage =
              "url(https://i.ibb.co/VtYM6tV/Screen-Shot-2021-07-16-at-10-16-46-PM.png)";
            el.style.width = "25px";
            el.style.height = "25px";
            el.style.backgroundSize = "100%";
            new mapboxgl.Marker(el)
              .setLngLat(eventList[x].location)
              .setPopup(
                new mapboxgl.Popup({ offset: 25 }) // add popups
                  .setHTML(
                    `<h3>${eventList[x].name}</h3><h4>${eventList[x].date}</h4><a href=${eventList[x].url}>click for event details</a>`
                  )
              )
              .addTo(map);
          }
        }
      };
    </script>
    <h2>Click on an event to see further details!</h2>
  </body>
</html>
